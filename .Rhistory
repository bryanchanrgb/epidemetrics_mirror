max_positive_rate_a
country_a
max(subset(figure_2_data,country==country_a)$new_tests,na.rm=TRUE)
subset(figure_2_data,country==country_a)$new_tests
View(figure_2_data)
max_tests_a=max(subset(figure_2_data,country==country_a)$new_tests_smooth,na.rm=TRUE)
figure_2_data <- read_csv("./data/figure_2.csv",
na = c("N/A","NA","#N/A"," ",""),
col_types = cols(date = col_date(format = "%Y-%m-%d"),
new_tests = col_double(),
new_tests_smooth = col_double(),
positive_rate = col_double(),
positive_rate_smooth = col_double()))
figure_2_data[figure_2_data$date<'2020-04-01','positive_rate'] <- NA
# Individual subplots
figure_2_a_1 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_a, y="New Cases per Day", x=element_blank())
+ theme_light()
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_a_2 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(y="Deaths per Day",x=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_a=max(subset(figure_2_data,country==country_a)$new_tests,na.rm=TRUE)
max_positive_rate_a=max(subset(figure_2_data,country==country_a)$positive_rate_smooth,na.rm=TRUE)
figure_2_a_3 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_a/max_positive_rate_a)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = "Tests per Day",
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_a/max_positive_rate_a), name = element_blank(),
breaks=c(0,0.002,0.004,0.006,0.008,0.010),
labels=c('0','0·002','0·004','0·006','0·008','0·010')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_b_1 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_b,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_b_2 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_b=max(subset(figure_2_data,country==country_b)$new_tests,na.rm=TRUE)
max_positive_rate_b=max(subset(figure_2_data,country==country_b)$positive_rate_smooth,na.rm=TRUE)
figure_2_b_3 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_b/max_positive_rate_b)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_b/max_positive_rate_b), name = element_blank()))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_c_1 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_c,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_c_2 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_c=max(subset(figure_2_data,country==country_c)$new_tests,na.rm=TRUE)
max_positive_rate_c=max(subset(figure_2_data,country==country_c)$positive_rate_smooth,na.rm=TRUE)
figure_2_c_3 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_c/max_positive_rate_c)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_c/max_positive_rate_c), name = element_blank()))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_d_1 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_d,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_d_2 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_d=max(subset(figure_2_data,country==country_d)$new_tests,na.rm=TRUE)
max_positive_rate_d=max(subset(figure_2_data,country==country_d)$positive_rate_smooth,na.rm=TRUE)
figure_2_d_3 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_d/max_positive_rate_d)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_d/max_positive_rate_d), name = "Positive Rate"))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
# Combining subplots
figure_2_all <- egg::ggarrange(figure_2_a_1,figure_2_b_1,figure_2_c_1,figure_2_d_1,
figure_2_a_2,figure_2_b_2,figure_2_c_2,figure_2_d_2,
figure_2_a_3,figure_2_b_3,figure_2_c_3,figure_2_d_3,
ncol=4)
# Individual subplots
figure_2_a_1 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_a, y="New Cases per Day", x=element_blank())
+ theme_light()
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_a_2 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(y="Deaths per Day",x=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_a=max(subset(figure_2_data,country==country_a)$new_tests,na.rm=TRUE)
max_positive_rate_a=max(subset(figure_2_data,country==country_a)$positive_rate_smooth,na.rm=TRUE)
figure_2_a_3 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_a/max_positive_rate_a)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = "Tests per Day",
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_a/max_positive_rate_a), name = element_blank(),
breaks=c(0,0.002,0.004,0.006,0.008,0.010),
labels=c('0','0·002','0·004','0·006','0·008','0·010')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_b_1 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_b,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_b_2 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_b=max(subset(figure_2_data,country==country_b)$new_tests,na.rm=TRUE)
max_positive_rate_b=max(subset(figure_2_data,country==country_b)$positive_rate_smooth,na.rm=TRUE)
figure_2_b_3 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_b/max_positive_rate_b)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_b/max_positive_rate_b), name = element_blank(),
breaks=c(0,0.05,0.10,0.15,0.20,0.25,0.30),
labels=c('0','0·05','0·10','0·15','0·20','0·25','0·30')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_c_1 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_c,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_c_2 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_c=max(subset(figure_2_data,country==country_c)$new_tests,na.rm=TRUE)
max_positive_rate_c=max(subset(figure_2_data,country==country_c)$positive_rate_smooth,na.rm=TRUE)
figure_2_c_3 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_c/max_positive_rate_c)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_c/max_positive_rate_c), name = element_blank(),
breaks=c(0,0.05,0.10,0.15,0.20),
labels=c('0','0·05','0·10','0·15','0·20')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_d_1 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_d,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_d_2 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_d=max(subset(figure_2_data,country==country_d)$new_tests,na.rm=TRUE)
max_positive_rate_d=max(subset(figure_2_data,country==country_d)$positive_rate_smooth,na.rm=TRUE)
figure_2_d_3 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_d/max_positive_rate_d)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_d/max_positive_rate_d), name = "Positive Rate",
breaks=c(0,0.05,0.10,0.15,0.20,0.25,0.30),
labels=c('0','0·05','0·10','0·15','0·20','0·25','0·30')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
# Combining subplots
figure_2_all <- egg::ggarrange(figure_2_a_1,figure_2_b_1,figure_2_c_1,figure_2_d_1,
figure_2_a_2,figure_2_b_2,figure_2_c_2,figure_2_d_2,
figure_2_a_3,figure_2_b_3,figure_2_c_3,figure_2_d_3,
ncol=4)
figure_2_all <- annotate_figure(figure_2_all,
top = text_grob("Figure 2: Cases, Deaths and Testing Over Time", size = 14))
figure_2_all <- annotate_figure(figure_2_all,
top = text_grob("Figure 2: Cases, Deaths and Testing Over Time", size = 14))
figure_2_all
# Individual subplots
figure_2_a_1 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_a, y="New Cases per Day", x=element_blank())
+ theme_light()
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_a_2 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(y="Deaths per Day",x=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_a=max(subset(figure_2_data,country==country_a)$new_tests,na.rm=TRUE)
max_positive_rate_a=max(subset(figure_2_data,country==country_a)$positive_rate_smooth,na.rm=TRUE)
figure_2_a_3 <- (ggplot(subset(figure_2_data,country==country_a))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_a/max_positive_rate_a)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = "Tests per Day",
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_a/max_positive_rate_a), name = element_blank(),
breaks=c(0,0.002,0.004,0.006,0.008,0.010),
labels=c('0','0·002','0·004','0·006','0·008','0·010')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_b_1 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_b,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_b_2 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_b=max(subset(figure_2_data,country==country_b)$new_tests,na.rm=TRUE)
max_positive_rate_b=max(subset(figure_2_data,country==country_b)$positive_rate_smooth,na.rm=TRUE)
figure_2_b_3 <- (ggplot(subset(figure_2_data,country==country_b))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_b/max_positive_rate_b)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_b/max_positive_rate_b), name = element_blank(),
breaks=c(0,0.05,0.10,0.15,0.20,0.25,0.30),
labels=c('0','0·05','0·10','0·15','0·20','0·25','0·30')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_c_1 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_c,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_c_2 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_c=max(subset(figure_2_data,country==country_c)$new_tests,na.rm=TRUE)
max_positive_rate_c=max(subset(figure_2_data,country==country_c)$positive_rate_smooth,na.rm=TRUE)
figure_2_c_3 <- (ggplot(subset(figure_2_data,country==country_c))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_c/max_positive_rate_c)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_c/max_positive_rate_c), name = element_blank(),
breaks=c(0,0.05,0.10,0.15,0.20),
labels=c('0','0·05','0·10','0·15','0·20')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
figure_2_d_1 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = new_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(title=country_d,x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title=element_text(size=12, hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
figure_2_d_2 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = dead_per_day),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = dead_per_day_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ labs(x=element_blank(),y=element_blank())
+ scale_y_continuous(expand = c(0,0),limits = c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt")))
max_tests_d=max(subset(figure_2_data,country==country_d)$new_tests,na.rm=TRUE)
max_positive_rate_d=max(subset(figure_2_data,country==country_d)$positive_rate_smooth,na.rm=TRUE)
figure_2_d_3 <- (ggplot(subset(figure_2_data,country==country_d))
+ geom_line(aes(x = date, y = new_tests),size=0.7,color=my_palette_1,na.rm=TRUE)
+ geom_line(aes(x = date, y = new_tests_smooth),size=1,color=my_palette_2,na.rm=TRUE)
+ geom_line(aes(x = date, y = positive_rate_smooth*(max_tests_d/max_positive_rate_d)),color=my_palette_3,na.rm=TRUE)
+ scale_y_continuous(name = element_blank(),
expand = c(0,0),limits = c(0, NA),
sec.axis = sec_axis(~./(max_tests_d/max_positive_rate_d), name = "Positive Rate",
breaks=c(0,0.05,0.10,0.15,0.20,0.25,0.30),
labels=c('0','0·05','0·10','0·15','0·20','0·25','0·30')))
+ labs(x="Date")
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7),plot.margin=unit(c(0,0,0,0),"pt"),
axis.title.y.left = element_text(color=my_palette_2), axis.title.y.right = element_text(color=my_palette_3)))
# Combining subplots
figure_2_all <- egg::ggarrange(figure_2_a_1,figure_2_b_1,figure_2_c_1,figure_2_d_1,
figure_2_a_2,figure_2_b_2,figure_2_c_2,figure_2_d_2,
figure_2_a_3,figure_2_b_3,figure_2_c_3,figure_2_d_3,
ncol=4)
figure_2_all <- annotate_figure(figure_2_all,
top = text_grob("Figure 2: Cases, Deaths and Testing Over Time", size = 14))
ggsave("./plots/figure_2.png", plot = figure_2_all, width = 16,  height = 8)
ggsave("./plots/figure_2.pdf", plot = figure_2_all, width = 16,  height = 8)
figure_4a_data <- read_csv(file="./data/figure_4a.csv",
na = c("N/A","NA","#N/A"," ",""))
figure_4a_data$countrycode <- as.factor(figure_4a_data$countrycode)
figure_4a_data$adm_area_1 <- as.factor(figure_4a_data$adm_area_1)
figure_4b_data <- read_delim(file="./data/figure_4.csv",
delim=";",
na = c("N/A","NA","#N/A"," ","","None"))
figure_4b_data$gid <- as.factor(figure_4b_data$gid)
figure_4b_data$fips <- as.factor(figure_4b_data$fips)
# Process Data for figure 4 -------------------------------------------------------------------
# Figure 4a processing
# Get top n states by total confirmed cases, group others into Others
figure_4a_max <- aggregate(figure_4a_data[c("confirmed")],
by = list(figure_4a_data$adm_area_1),
FUN = max,
na.rm=TRUE)
figure_4a_max <- plyr::rename(figure_4a_max, c("Group.1"="adm_area_1"))
figure_4a_max <- figure_4a_max[order(-figure_4a_max$confirmed),]
n=15
top_n <- head(figure_4a_max$adm_area_1,n)
figure_4a_longitudes <- unique(figure_4a_data[figure_4a_data$adm_area_1%in%top_n,c("adm_area_1","longitude")])
figure_4a_longitudes <- figure_4a_longitudes[order(figure_4a_longitudes$longitude),]
figure_4a_longitudes <- figure_4a_longitudes$adm_area_1
figure_4a_data$State <- figure_4a_data$adm_area_1
levels(figure_4a_data$State) <- c(levels(figure_4a_data$State), "Others")
figure_4a_data[!figure_4a_data$adm_area_1%in%top_n,"State"] <- "Others"
figure_4a_data$State <- factor(figure_4a_data$State, levels=c(lapply(figure_4a_longitudes, as.character), "Others"))
figure_4a_agg <- aggregate(figure_4a_data[c("new_per_day_smooth")],
by = list(figure_4a_data$State,figure_4a_data$date),
FUN = sum,
na.rm=TRUE)
figure_4a_agg <- plyr::rename(figure_4a_agg, c("Group.1"="State","Group.2"="date"))
# Figure 4b processing
# Sort by GID and date
figure_4b_data <- figure_4b_data[order(figure_4b_data$gid, figure_4b_data$date),]
# Compute new cases per day as difference between daily case total
figure_4b_data[-1,"new_cases"] <- diff(figure_4b_data$cases)
# Remove first day of each GID as it does not have a value for new cases
figure_4b_data <- figure_4b_data[duplicated(figure_4b_data$gid),]
# Set any negative values for new cases to 0
figure_4b_data[figure_4b_data$new_cases<0,"new_cases"] <- 0
# Compute new cases per 10000 popuation
figure_4b_data$new_cases_per_10k <- 10000*figure_4b_data$new_cases/figure_4b_data$Population
# Define which dates to plot in choropleth
date_1 <- as.Date("2020-04-14")
date_2 <- as.Date("2020-07-21")
date_3 <- as.Date("2020-11-20")
# Subset for the two dates select
figure_4b1_data <- subset(figure_4b_data,date==date_1)
figure_4b2_data <- subset(figure_4b_data,date==date_2)
figure_4b3_data <- subset(figure_4b_data,date==date_3)
# Set max value to show. Censor any values above this
color_max <- 250
figure_4b1_data$new_cases_censored <- figure_4b1_data$new_cases
figure_4b1_data$new_cases_censored[figure_4b1_data$new_cases_censored > color_max] <- color_max
figure_4b2_data$new_cases_censored <- figure_4b2_data$new_cases
figure_4b2_data$new_cases_censored[figure_4b2_data$new_cases_censored > color_max] <- color_max
figure_4b3_data$new_cases_censored <- figure_4b3_data$new_cases
figure_4b3_data$new_cases_censored[figure_4b3_data$new_cases_censored > color_max] <- color_max
# Convert the dataframe for figure_4b1 and 4b2 data into spatial dataframe
# Remove rows with NA in geometry. Required to convert column to shape object
figure_4b1_data <- subset(figure_4b1_data,!is.na(geometry))
figure_4b2_data <- subset(figure_4b2_data,!is.na(geometry))
figure_4b3_data <- subset(figure_4b3_data,!is.na(geometry))
# Convert "geometry" column to a sfc shape column
figure_4b1_data$geometry <- st_as_sfc(figure_4b1_data$geometry)
figure_4b2_data$geometry <- st_as_sfc(figure_4b2_data$geometry)
figure_4b3_data$geometry <- st_as_sfc(figure_4b3_data$geometry)
# Convert dataframe to a sf shape object with "geometry" containing the shape information
figure_4b1_data <- st_sf(figure_4b1_data)
figure_4b2_data <- st_sf(figure_4b2_data)
figure_4b3_data <- st_sf(figure_4b3_data)
# Figure 4: USA time series and choropleth ----------------------------------------------
# Set up colour palette
my_palette_1 <- brewer.pal(name="YlGnBu",n=4)[2]
my_palette_2 <- brewer.pal(name="YlGnBu",n=4)[4]
my_palette_3 <- "GnBu"
my_palette_4 <- brewer.pal(name="Oranges",n=4)[4]
# Viridis color palette with last item gray
v_palette <-  viridis(n+1, option="D")
v_palette[n+1] <- "#C0C0C0"
# Figure 4a: Stacked Area Time series of US counties
figure_4a <-  (ggplot(data=figure_4a_agg, aes(x=date,y=new_per_day_smooth,fill=State))
+ geom_area(alpha=0.8, colour="white", na.rm=TRUE)
+ scale_fill_manual(values = v_palette)
+ labs(title="New Cases Over Time for US States", y="New Cases per Day (Smoothed)", x="Date")
+ scale_x_date(date_breaks="months", date_labels="%b")
+ scale_y_continuous(expand=c(0,0), limits=c(0, NA))
+ theme_light()
+ theme(plot.title = element_text(hjust = 0.5), axis.line=element_line(color="black",size=0.7),axis.ticks=element_line(color="black",size=0.7)
,plot.margin=unit(c(0,0,0,0),"pt"), legend.position = c(0.09, 0.6),
legend.title = element_text(size = 12),legend.text = element_text(size = 11)))
figure_4a
ggsave("./plots/figure_4a.png", plot = figure_4a, width = 15,  height = 7)
ggsave("./plots/figure_4a.pdf", plot = figure_4a, width = 15,  height = 7)
# Figure 4b: Choropleth of US counties at USA peak dates
figure_4b1 <- (ggplot(data = figure_4b1_data)
+ geom_sf(aes(fill=new_cases_censored), lwd=0, color=NA, na.rm=TRUE)
+ labs(title=paste("New Cases per Day per United States County at",date_1), fill="New Cases per Day")
+ scale_fill_distiller(palette=my_palette_3, trans="reverse", limits=c(color_max,0))
+ scale_x_continuous(expand=c(0,0), limits=c(-125, -65)) # coordinates are cropped to exclude Alaska
+ scale_y_continuous(expand=c(0,0), limits=c(24, 50))
+ theme_void()
+ guides(fill = guide_colourbar(barwidth = 30, barheight = 0.6, reverse=T))
+ theme(plot.title = element_text(hjust = 0.5), panel.grid.major=element_line(colour = "transparent"),legend.position="bottom"))
ggsave("./plots/figure_4b1.png", plot = figure_4b1, width = 9,  height = 7)
ggsave("./plots/figure_4b1.pdf", plot = figure_4b1, width = 9,  height = 7)
figure_4b2 <- (ggplot(data = figure_4b2_data)
+ geom_sf(aes(fill=new_cases_censored), lwd=0, color=NA)
+ labs(title=paste("New Cases per Day per United States County at",date_2), fill="New Cases per Day")
+ scale_fill_distiller(palette=my_palette_3, trans="reverse", limits=c(color_max,0))
+ scale_x_continuous(expand=c(0,0), limits=c(-125, -65)) # coordinates are cropped to exclude Alaska
+ scale_y_continuous(expand=c(0,0), limits=c(24, 50))
+ theme_void()
+ guides(fill = guide_colourbar(barwidth = 30, barheight = 0.6, reverse=T))
+ theme(plot.title = element_text(hjust = 0.5), panel.grid.major=element_line(colour = "transparent"),legend.position="bottom"))
ggsave("./plots/figure_4b2.png", plot = figure_4b2, width = 9,  height = 7)
ggsave("./plots/figure_4b2.pdf", plot = figure_4b2, width = 9,  height = 7)
figure_4b3 <- (ggplot(data = figure_4b3_data)
+ geom_sf(aes(fill=new_cases_censored), lwd=0, color=NA)
+ labs(title=paste("New Cases per Day per United States County at",date_3), fill="New Cases per Day")
+ scale_fill_distiller(palette=my_palette_3, trans="reverse", limits=c(color_max,0))
+ scale_x_continuous(expand=c(0,0), limits=c(-125, -65)) # coordinates are cropped to exclude Alaska
+ scale_y_continuous(expand=c(0,0), limits=c(24, 50))
+ theme_void()
+ guides(fill = guide_colourbar(barwidth = 30, barheight = 0.6, reverse=T))
+ theme(plot.title = element_text(hjust = 0.5), panel.grid.major=element_line(colour = "transparent"),legend.position="bottom"))
ggsave("./plots/figure_4b3.png", plot = figure_4b3, width = 9,  height = 7)
ggsave("./plots/figure_4b3.pdf", plot = figure_4b3, width = 9,  height = 7)
